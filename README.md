# MaSeq
Pypulseq Interpreter in [MaGRE](https://github.com/josalggui/MaRGE/wiki) and [Marcos](https://github.com/vnegnev/marcos_extras/wiki) System

This repository is a fork of the [josalggui/MaGRE](https://github.com/josalggui/MaRGE.git) repository. We have extended MaGRE by integrating the Pypulseq interpreter to enhance the system's functionality.
 
## Overview

Our fork of the MaGRE repository adds a **Pypulseq interpreter**, enabling the following key features:

- **Pypulseq sequence programming**: Users can define MRI pulse sequences using the Pypulseq framework.
- **Graphical User Interface (GUI) for parameter input**: An intuitive interface for inputting parameters related to the MRI sequence.
- **Sequence dispatch to Marcos terminal**: The ability to send the defined pulse sequence to the Marcos terminal for execution.
- **Image display**: The final step involves the display of images generated by the executed pulse sequences.

This system allows for a streamlined process from programming MRI pulse sequences to visualizing the resulting images, all within a unified environment.
. 

## 1. Setting up MaSeq

Reference link is: https://github.com/josalggui/MaRGE/wiki/Setting-up-MaRGE

### 0. Clone the MaSeq repository in your work folder
```
git clone https://github.com/linkaishengmri/MaSeq_pack.git
```
Go to the folder:
```
cd ~/<your_work_folder>/MaSeq_pack
```

### 1. Clone the required repositories in the folder of the client computer:
```
git clone https://github.com/linkaishengmri/marcos_client.git
git clone https://github.com/vnegnev/marcos_server.git
git clone https://github.com/vnegnev/marcos_extras.git
git clone https://github.com/linkaishengmri/MaSeq.git
```

### 2. Create and modify the configuration files:

2.1. `local_config.py` in the `marcos_client` folder
This file contains details about the Red Pitaya hardware, including:
- Red Pitaya IP address
- GPA board information (ocra1 must be selected, because gpa-fhdo is not yet available up to now on our MaSeq repo)

2.2. `hw_config.py` in the `MaSeq/configs` folder
Contains information about:
- Scanner hardware (rp-122 must be selected)
- Red Pitaya IP address 

2.3. `sys_config.py` in the `MaSeq/configs` folder
Contains settings related to:
- GUI session display

2.4. `units.py` in the `MaSeq/configs` folder
Typically doesn't need modification.


### 3. Set up bash: Set the bash_path variable in the hw_config.py file:

For Windows:
```
bash_path = "C:/path/to/git_bash.exe"
```
For Ubuntu:
```
bash_path = "gnome-terminal"
```
### 4. Install required modules:
```
pip install -r requirements.txt
```
If you have errors:
```
File "/home/lks/marcos_pack/marcos_client/marcompile.py", line 295, in cl2ol
    old_val_unmasked = current_bufs[buf] & ~mask
OverflowError: Python integer -65 out of bounds for uint16
```
then 
```
pip install numpy==1.26.4
```
### 5. Run GUI:
```
cd MaSeq
unset GTK_PATH
python main.py
```

end
